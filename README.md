## Защищённая аутентификация в базе данных

В данном репозитории представлен практический пример создания защищённой системы аутентификации и авторизации на языке **Python** с использованием **Argon2id**, асинхронного взаимодействия с **PostgreSQL** и механизмов контроля доступа. Работа основана на современных подходах к хранению паролей, проверке учётных данных и управлению пользовательскими сессиями.

Система включает в себя:
- безопасное хэширование паролей (Argon2id);
- экспоненциальную блокировку при множестве неверных попыток входа;
- ролевую модель доступа;
- хранение и продление пользовательских сессий в БД;
- смену пароля с проверкой старого.

##  Используемые технологии

- **Python 3.9**
- **argon2-cffi** — защищённое хэширование паролей
- **asyncio** — асинхронная логика
- **asyncpg** — высокопроизводительный асинхронный драйвер PostgreSQL
- **PostgreSQL** — серверная СУБД

##  Ключевые возможности CLI
CLI-интерфейс предоставляет доступ ко всем функциям системы: регистрации, входу, проверке ролей, разрешений и управлению сессиями.

#### **Регистрация нового пользователя**

Позволяет создать учётную запись, указав email, пароль и роль:

```cmd
py cli.py signup email password [role]
```

Если роль не указана, по умолчанию используется student.

#### Авторизация пользователя
Выполняет вход в систему, создаёт сессию и сохраняет токен в локальный файл:
```

py cli.py login email password
```

Встроен механизм экспоненциальной задержки при повторяющихся ошибках входа.

#### Информация о текущем пользователе
```
py cli.py whoami
```

#### Выход из системы
```
py cli.py logout
```

Удаляет активный токен и завершает сессию.

#### Проверка роли
```
py cli.py check-role role_name
```
Позволяет убедиться, обладает ли пользователь требуемым уровнем доступа.

#### Проверка разрешений
```
py cli.py check-perm permission_name
```

Используется для проверки конкретного действия (например, manage_users).

#### Смена пароля
```
py cli.py change-password old_password new_password
```

Система требует подтверждения старого пароля и формирует новый Argon2id-хэш.

## Как запустить
1. Создать и активировать виртуальное окружение:
```
py -m venv venv
venv\Scripts\activate
```
2. Установить зависимости:
```
pip install -r requirements.txt
```
3. Скопировать инициализацию таблиц в БД, настроить config.py 
4. Запустить CLI:
```
py cli.py --help
```


## Особенности безопасности
1. Алгоритм Argon2id обеспечивает стойкость к современным атакам перебора;
2. Хранение соли встроено в формат хэша;
3. Экспоненциальный бэкофф делает brute-force попытки неэффективными;
4. Токены создаются через uuid4() и привязываются к сроку действия;
5. Управление сессиями исключает использование устаревших или скомпрометированных токенов.
